version: 2

models:
  - name: base_sql_server_dbo__orders
    description: >
      Each of the orders ordered to the company.
    columns:
      - name: order_id
        data_type: varchar
        description: >
          Unique identifier of each order.
        tests:
          - not_null
          - unique

      - name: user_id
        data_type: varchar
        description: >
          Identifier of the user.
        tests:
          - not_null

      - name: address_id
        data_type: varchar
        description: >
          Identifier of the shipping address.
        tests:
          - not_null

      - name: tracking_id
        data_type: varchar
        description: >
          Shipping tracking id.

      - name: shipping_service
        data_type: varchar
        description: >
          Shipping service in charge of delivery.

      - name: status
        data_type: varchar
        description: >
          Status of the order.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: created_at_utc
        data_type: timestamp_tz
        description: >
          Order generation datetime in UTC.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: estimated_delivery_at_utc
        data_type: timestamp_tz
        description: >
          Delivery time estimated by the shipping service, in UTC.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: delivered_at_utc
        data_type: timestamp_tz
        description: >
          Actual delivery time by the shipping service, in UTC.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: order_cost
        data_type: float
        description: >
          Cost of the order (sum product units times product price).
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " > 0"
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float

      - name: shipping_cost
        data_type: float
        description: >
          Cost associated with the shipping service.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float

      - name: promo_id
        data_type: varchar
        description: >
          Promotion description.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: order_total
        data_type: float
        description: >
          Total cost of the order (order_cost + shipping_cost - discount).
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " > 0"
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float

      - name: _fivetran_deleted
        data_type: boolean
        description: >
          fivetran_deleted

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: base_sql_server_dbo__addresses
    description: >
      Addresses information. Either users address or order destination.
    columns:
      - name: address_id
        data_type: varchar
        description: >
          Unique identifier for each address.
        tests:
          - not_null
          - unique

      - name: zipcode
        data_type: number
        description: >
          Zipcode of each address.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: country
        data_type: varchar
        description: >
          County of each address.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: address
        data_type: varchar
        description: >
          Address description.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: state
        data_type: varchar
        description: >
          State of each address.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: stg_sql_server_dbo__addresses
    description: >
      Addresses information. Either users address or order destination.
    columns:
      - name: address_id
        data_type: varchar
        description: >
          Unique identifier for each address.
        tests:
          - not_null
          - unique

      - name: zipcode
        data_type: number
        description: >
          Zipcode of each address.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: country_id
        data_type: varchar
        description: >
          Identifier of each country.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__address_country')
              field: country_id

      - name: address
        data_type: varchar
        description: >
          Address description.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: state_id
        data_type: varchar
        description: >
          Identifier of each state.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__address_state')
              field: state_id

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: stg_sql_server_dbo__address_country
    description: >
      Addresses country information.
    columns:
      - name: country_id
        data_type: varchar
        description: >
          Unique identification for each country.
        tests:
          - not_null
          - unique

      - name: country
        data_type: varchar
        description: >
          Country description.
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar


  - name: stg_sql_server_dbo__address_state
    description: >
      Addresses state information.
    columns:
      - name: state_id
        data_type: varchar
        description: >
          Unique identification for each state.
        tests:
          - not_null
          - unique

      - name: state
        data_type: varchar
        description: >
          State description.
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar


  - name: stg_sql_server_dbo__event_types
    description: >
      Description of the different types of events that take place in the website.
    columns:
      - name: event_type
        data_type: varchar
        description: >
          Event type description.
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: event_type_id
        data_type: varchar
        description: >
          Unique identifier of each type of event.
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar


  - name: stg_sql_server_dbo__events
    description: >
      Each of the events registered in the webpage.
    columns:
      - name: event_id
        data_type: varchar
        description: >
          Unique identifier of each event
        tests:
          - not_null
          - unique

      - name: session_id
        data_type: varchar
        description: >
          Identifier of each session.
        tests:
          - not_null

      - name: user_id
        data_type: varchar
        description: >
          Identifier of each user.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__users')
              field: user_id

      - name: event_type_id
        data_type: varchar
        description: >
          Identifier of each type of event
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__event_types')
              field: event_type_id

      - name: page_url
        data_type: varchar
        description: >
          url associated to each event.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: created_at_utc
        data_type: timestamp_tz
        description: >
          Event generation datetime in UTC.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: product_id
        data_type: varchar
        description: >
          Identifier for each product. Null when event_type_id corresponds to checkout or package_shipped.
        tests:
          - dbt_utils.relationships_where:
              to: ref('stg_sql_server_dbo__products')
              field: product_id
              from_condition: product_id is not null

      - name: order_id
        data_type: varchar
        description: >
          Identifier of each order. Null when event_type_id does not correspond to checkout or package_shipped.
        tests:
          - dbt_utils.relationships_where:
              to: ref('stg_sql_server_dbo__orders')
              field: order_id
              from_condition: order_id is not null

      - name: _fivetran_deleted
        data_type: boolean
        description: >
          fivetran_deleted

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: stg_sql_server_dbo__order_items
    description: >
      Products purchased in each order.
    columns:
      - name: order_id
        data_type: varchar
        description: >
          Identifier of each order.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__orders')
              field: order_id

      - name: product_id
        data_type: varchar
        description: >
          Identifier of each product.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__products')
              field: product_id

      - name: quantity
        data_type: number
        description: >
          Number of products purchased.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: _fivetran_deleted
        data_type: boolean
        description: >
          fivetran_deleted

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: stg_sql_server_dbo__orders
    description: >
      Each of the orders ordered to the company.
    columns:
      - name: order_id
        data_type: varchar
        description: >
          Unique identifier of each order.
        tests:
          - not_null
          - unique

      - name: user_id
        data_type: varchar
        description: >
          Identifier of each user.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__users')
              field: user_id

      - name: address_id
        data_type: varchar
        description: >
          Identifier of the shipping address.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__addresses')
              field: address_id

      - name: status_id
        data_type: varchar
        description: >
          Identifier of the order status.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__status')
              field: status_id
         
      - name: created_at_utc
        data_type: timestamp_tz
        description: >
          Order generation datetime in UTC.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: order_cost
        data_type: float
        description: >
          Cost of the order (sum product units times product price).
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " > 0"
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float

      - name: promo_id
        data_type: varchar
        description: >
          Identifier of the promotion description.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__promos')
              field: promo_id

      - name: order_total
        data_type: float
        description: >
          Total cost of the order (order_cost + shipping_cost - discount).
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " > 0"
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float

      - name: _fivetran_deleted
        data_type: boolean
        description: >
          fivetran_deleted

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: stg_sql_server_dbo__products
    description: >
      All our products.
    columns:
      - name: product_id
        data_type: varchar
        description: >
          Unique identifier of each product.
        tests:
          - not_null
          - unique

      - name: price
        data_type: float
        description: >
          Price of each product unit.
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " > 0"
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float

      - name: product_name
        data_type: varchar
        description: >
          Description of the product.
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: inventory
        data_type: number
        description: >
          Product inventory.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: _fivetran_deleted
        data_type: boolean
        description: >
          fivetran_deleted

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: stg_sql_server_dbo__shipping_info
    description: >
      Information about the shipping of each order.
    columns:
      - name: order_id
        data_type: varchar
        description: >
          Unique identifier of each order.
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('stg_sql_server_dbo__orders')
              field: order_id

      - name: tracking_id
        data_type: varchar
        description: >
          Tracking id of each order.

      - name: shipping_service_id
        data_type: varchar
        description: >
          Identifier of the shipping service.
        tests:
          - relationships:
              to: ref('stg_sql_server_dbo__shipping_service')
              field: shipping_service_id

      - name: estimated_delivery_at_utc
        data_type: timestamp_tz
        description: >
          Delivery time estimated by the shipping service, in UTC.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: delivered_at_utc
        data_type: timestamp_tz
        description: >
          Actual delivery time by the shipping service.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: shipping_cost
        data_type: float
        description: >
          Cost associated with the shipping service.
        tests:
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: float
        

  - name: stg_sql_server_dbo__shipping_service
    description: >
      Information about the shipping service. 
    columns:
      - name: shipping_service
        data_type: varchar
        description: >
          Description of the service shipping.
        tests:
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: shipping_service_id
        data_type: varchar
        description: >
          Unique identifier of each shipping service.
        tests:
          - not_null
          - unique
          

  - name: stg_sql_server_dbo__users
    description: >
      Users information.
    columns:
      - name: user_id
        data_type: varchar
        description: >
          Unique identifier of each user.
        tests:
          - not_null
          - unique

      - name: address_id
        data_type: varchar
        description: >
          Identifier of the address associated with the user.
        tests:
          - not_null
          - relationships:
              to: ref('stg_sql_server_dbo__addresses')
              field: address_id

      - name: first_name
        data_type: varchar
        description: >
          First user name.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: last_name
        data_type: varchar
        description: >
          Last user namr
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: email
        data_type: varchar
        description: >
          User email.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: phone_number
        data_type: number
        description: >
          User phone number
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: created_at_utc
        data_type: timestamp_tz
        description: >
          User generation datetime in UTC.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: updated_at_utc
        data_type: timestamp_tz
        description: >
          Last datetime of user information update.
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ

      - name: _fivetran_deleted
        data_type: boolean
        description: >
          fivetran_deleted

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ


  - name: stg_sql_server_dbo__status
    description: >
      Status of the orders.
    columns:
      - name: status_id
        data_type: varchar
        description: >
          Unique identifier of each type of status.
        tests:
          - not_null
          - unique

      - name: status
        data_type: varchar
        description: >
          Status description.
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar


  - name: stg_sql_server_dbo__promos
    description: >
      Promotions applicable to the orders.
    columns:
      - name: promo_id
        data_type: varchar
        description: >
          Unique identifier of each promotion.
        tests:
          - not_null
          - unique

      - name: promo_desc
        data_type: varchar
        description: >
          Promotion description.
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: discount
        data_type: number
        description: >
          Promotion discount (in dollar).
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number

      - name: status
        data_type: varchar
        description: >
          Status of the promotion. If it is avaliable in the webpage or not. 
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar

      - name: _fivetran_deleted
        data_type: boolean
        description: >
          fivetran_deleted

      - name: _fivetran_synced_utc
        data_type: timestamp_tz
        description: >
          fivetran_synced in UTC
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: Timestamp_TZ
